

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9.4. Urban Energy Balance - SUEWS and WUDAPT &mdash; SUEWS v2018c documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="10. Development, Suggestions and Support" href="../../../../../development/development.html" />
    <link rel="prev" title="9.3. Urban Energy Balance - SUEWS Spatial" href="SuewsSpatial.html" /> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> SUEWS
          

          
          </a>

          
            
            
              <div class="version">
                v2018c
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../parameterisations-and-sub-models.html">2. Parameterisations and sub-models within SUEWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../prepare-to-run-the-model.html">3. Preparing to run the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../input_files/input_files.html">4. Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../output_files/output_files.html">5. Output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../troubleshooting.html">6. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../recent-publications.html">7. Recent publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../suews_related_softwares.html">8. SUEWS-related Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">9. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../development/development.html">10. Development, Suggestions and Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../benchmark/benchmark_report.html">Benchmark Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../version-history/version-history.html">11. Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../acknowledgement.html">12. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notation.html">13. Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../references.html">14. References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">SUEWS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../tutorials.html">9. Tutorials</a> &raquo;</li>
        
      <li>9.4. Urban Energy Balance - SUEWS and WUDAPT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/sub-tutorials/tutorials/docs/source/Tutorials/SuewsWUDAPT.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please report issues with the manual on the <a class="reference external" href="https://github.com/Urban-Meteorology-Reading/SUEWS-Docs/issues/new?template=issue-report.md">GitHub page</a>.</p>
</div>
<div class="section" id="urban-energy-balance-suews-and-wudapt">
<span id="suewswudapt"></span><h1>9.4. Urban Energy Balance - SUEWS and WUDAPT<a class="headerlink" href="#urban-energy-balance-suews-and-wudapt" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>9.4.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This tutorial is not ready for use. Work in progress.</p>
</div>
<p>In this tutorial you will generate input data for the
<a class="reference external" href="http://suews-docs.readthedocs.io">SUEWS</a> model and simulate spatial
(and temporal) variations of energy exchanges within an area in New York City using local climate zones derived within the <a class="reference external" href="http://www.wudapt.org/">WUDAPT</a> project. The World Urban Database and Access Portal Tools project is a community-based project to gather a census of cities around the world.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This tutorial is currently designed to work with QGIS 2.18. It is strongly recommended that you goo through the <a class="reference internal" href="SuewsSpatial.html#suewsspatial"><span class="std std-ref">Urban Energy Balance - SUEWS Spatial</span></a> tutorial before you go through this tutrial.</p>
</div>
</div>
<div class="section" id="objectives">
<h2>9.4.2. Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<p>To prepare input data for the SUEWS model using a WUDAPT dataset and analyse energy exchanges within an area in New York City, US.</p>
</div>
<div class="section" id="initial-steps">
<h2>9.4.3. Initial Steps<a class="headerlink" href="#initial-steps" title="Permalink to this headline">¶</a></h2>
<p>UMEP is a python plugin used in conjunction with
<a class="reference external" href="http://www.qgis.org">QGIS</a>. To install the software and the UMEP
plugin see the <a class="reference external" href="http://umep-docs.readthedocs.io/en/latest/Getting_Started.html">getting started</a> section in the UMEP manual.</p>
<p>As UMEP is under development, some documentation may be missing and/or
there may be instability. Please report any issues or suggestions to our
<a class="reference external" href="https://bitbucket.org/fredrik_ucg/umep/">repository</a>.</p>
<div class="section" id="loading-and-analyzing-the-spatial-data">
<h3>9.4.3.1. Loading and analyzing the spatial data<a class="headerlink" href="#loading-and-analyzing-the-spatial-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can download the all the data from <a class="reference external" href="https://github.com/Urban-Meteorology-Reading/Urban-Meteorology-Reading.github.io/blob/master/other%20files/SUEWSWUDAPT_NYC.zip">here</a>. Unzip and place in a folder where you have read and write access to. The LCZ data for various cities are also available from the <a class="reference external" href="http://www.wudapt.org/">WUDAPT</a> portal.</p>
</div>
<ul class="simple">
<li>Start by loading the raster dataset (<strong>NYC_LCZ.tif</strong>) into an empty QGIS project. This dataset is referenced to the WGS84 CRS (ESPG:4326).</li>
<li>You can set the correct colors for your LCZ raster by opening the LCZ converter at <em>UMEP &gt; Pre-Processer &gt; Spatial data &gt; LCZ converter</em>. In the upper right corner, choose the LCZ raster and press <em>Color Raster</em> and then close the <em>LCZ Converter</em>.</li>
</ul>
</div>
</div>
<div class="section" id="vector-grid-generation">
<h2>9.4.4. Vector grid generation<a class="headerlink" href="#vector-grid-generation" title="Permalink to this headline">¶</a></h2>
<p>A vector polygon grid is required for specifying the extent and resolution of the modelling.You will make use of a built-in tool in QGIS to generate such a grid.</p>
<ol class="arabic simple">
<li>First zoom in to Manhattan as shown in the figure below</li>
</ol>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../../../../../_images/SUEWS_WUDAPT_NYC_ManhattanZoom.jpg"><img alt="none" src="../../../../../_images/SUEWS_WUDAPT_NYC_ManhattanZoom.jpg" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 9.23 </span><span class="caption-text">Zoom in the Manhattan island.</span></p>
</div>
<ol class="arabic simple">
<li>As WGS84 (EPSG:4326) is in degree coordinates and maybe you want to specify your grid in meters, you need to change the CRS of your current QGIS-project. Click on the globe at the bottom right of your QGIS window and select <em>ESPG:26918</em> as your ‘on the fly’ CRS.</li>
<li>Open vector grid at <em>Vector &gt; Research Tools &gt; Vector grid</em>.</li>
<li>Select the extend of your canvas by clicking the … next to <em>Grid
extent (xmin, xmax, ymin, ymax)</em> and select <em>Use layer/canvas
extent</em>.</li>
<li>Select <em>Use Canvas Extent</em>.</li>
<li>As you can see the units in now in meters and not in degrees. Specify the desired grid spacing to 5000 meters. This will save time later on. Of course you can set it a much smaller number if you have the time to wait when the model performs the calculations later on.</li>
<li>Make sure the output is in polygons, not lines.</li>
<li>Create as temporary layer.</li>
<li>Save your grid by right-click on the new layer in the <em>Layers Panel</em> and choose <em>Save as…</em>. Here it is very imporant that you save in the same CRS as you other layers (ESPG:4326). Save as a shape file.</li>
</ol>
</div>
<div class="section" id="population-density">
<h2>9.4.5. Population density<a class="headerlink" href="#population-density" title="Permalink to this headline">¶</a></h2>
<p>Population density is required to estimate the anthropogenic heat release (Q<sub>F</sub>) in SUEWS. There is a possibility to make use of both night-time and daytime population densities to make the model more dynamic. In this tutorial you will only use a night-time dataset. This dataset can be aqcuired from the <em>Spatial Data Downloader</em> in UMEP.</p>
<ol class="arabic">
<li><p class="first">Open de spatial downloader at <em>UMEP &gt; Pre-Processer &gt; Spatial data &gt;
Spatial Data Downloader</em>.</p>
</li>
<li><p class="first">Select <em>population density</em> and select the <em>GPWv4: UN-Adjusted
Population Density</em> closest to the year you intend to model (2010). The values will be in (pp / square kilometer).</p>
</li>
<li><p class="first">Make sure your canvas is zoomed out to the entire LCZ map and click
<em>Use canvas extent</em></p>
</li>
<li><p class="first">Now click <em>Get data</em>.</p>
</li>
<li><p class="first">Save as a geoTiff (.tif) with the name <strong>GPWv4_2010</strong>.</p>
</li>
<li><p class="first">Now you need to calculate population density per grid in units <em>pp/hectare</em>. First open the QGIS built-in tool <em>Zonal statistics</em> (<em>Raster &gt; Zonal Statistics</em>). If the tool is absent you need to activate it by going to <em>Plugins &gt; Manage and Install Plugins</em> and add <em>Zonal statistics plugin</em>. Open the tool and make the settings as shown below. This will calulate mean population density per grid.</p>
<div class="figure" id="id2">
<img alt="none" src="../../../../../_images/SUEWS_WUDAPT_NYC_Zonalstat.jpg" />
<p class="caption"><span class="caption-number">Fig. 9.24 </span><span class="caption-text">Settings for the Zonal statistics plugin.</span></p>
</div>
</li>
<li><p class="first">Open the attribute table for your <strong>Grid_5000m</strong>-layer (right-click on layer and choose (<em>Open attribute Table</em>).</p>
</li>
<li><p class="first">Click the abacus shaped symbol this is the <em>Field calculator</em>.</p>
</li>
<li><p class="first">Under <em>Output field name</em> write “pp_ha, the <em>Output field type</em> should be “Decimal number (real)”, and the <em>Output Precision</em> can be set to 2.</p>
</li>
<li><p class="first">In the expression dialog box write gpw_mean/100, here gpw_mean is the name of your population density field and the 100 is to convert the data from km<sup>2</sup> to ha.</p>
</li>
<li><p class="first">Click <em>OK</em> and you should have a new field called “pp_ha”.</p>
</li>
<li><p class="first">Click the yellow pencil in the top left corner of the attribute table to stop editing and save your changes and close the attribute table.</p>
</li>
</ol>
</div>
<div class="section" id="lcz-converter">
<h2>9.4.6. LCZ converter<a class="headerlink" href="#lcz-converter" title="Permalink to this headline">¶</a></h2>
<p>Now you will make use of the <em>LCZ Converter</em>-plugin to generate input data for the SUEWS model.</p>
<ol class="arabic simple">
<li>Open the LCZ converter at <em>UMEP &gt; Pre-Processer &gt; Spatial data &gt; LCZ
converter</em>.</li>
<li>Select the LCZ raster layer at ‘’ LCZ raster’‘.</li>
<li>Select the vector grid you have just created in step 3 at <em>Vector
grid</em> and select the ID field of the polygon grid at <em>ID field</em>.</li>
<li>By clicking <em>Adjust default parameters</em> you can edit the table. This
table specifies the pervious, trees, grass, etc. fractions for each
of the LCZ classes. For more information about each of the classes
see <a class="reference external" href="http://umep-docs.readthedocs.io/en/latest/pre-processor/Spatial%20Data%20LCZ%20Converter.html">LCZConverter</a>.
If you choose to edit the table, make sure all fractions add up to
1.0.</li>
<li>If you are unsure about the exact fractions for each of the LCZ click
the tab <em>Pervious distribution</em>. Select <em>Same for all LCZ’s</em></li>
</ol>
<div class="figure" id="id3">
<img alt="none" src="../../../../../_images/LCZ_converter.png" />
<p class="caption"><span class="caption-number">Fig. 9.25 </span><span class="caption-text">Settings for the LCZ converter plugin.</span></p>
</div>
<ol class="arabic simple">
<li>Now you can select your best estimate about the distribution of the
pervious surface fractions for urban and the tree distribution for
rural. In addition, also specify the expected height of the trees.</li>
<li>Once you are satisfied click <em>Update Table</em>.</li>
<li>Select add results to polygon.</li>
<li>Add a file prefix if desired.</li>
<li>Finally select an output folder where you would like to receive the
text files and click <em>Run</em>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For mac users use this workaround: manually create a directory, go into the folder above and type the folder name. It will give a warning  “—folder name–” already exists. Do you want to replace it? Click <em>replace</em>.</p>
</div>
<p>This should generate 3 text files, one with the land cover fractions,
one with morphometric parameters for buildings and one for trees for
each grid cell of the polygon grid.</p>
</div>
<div class="section" id="suews">
<h2>9.4.7. SUEWS<a class="headerlink" href="#suews" title="Permalink to this headline">¶</a></h2>
<p>Before running SUEWS, you will need to
prepare some of the data required to run it.</p>
<ol class="arabic simple">
<li>SUEWS prepare requires the grid CRS to be in metres not degrees, therefore we need to reproject the grid. Right-click the vector grid and click <em>save as..</em>. Assign a different file name, use CRS <em>ESPG:26918</em> and click <em>OK</em>.</li>
<li>Open SUEWS prepare at: <em>UMEP &gt; Pre-Processer &gt; SUEWS prepare</em>.</li>
<li>Under <em>vector polygon grid</em> specify your reprojected vector grid and the <em>ID field</em>.</li>
<li>Select the location of the <em>Meteorological file</em> that was included in the input data, the building morphology (<em>_build_</em>), tree morphology (<em>_veg_</em>) and land cover fractions (<em>_LCFGrid_</em>) from the step above and the population density (pp_ha) in the dropdown list.</li>
<li>Enter the start and end of day light savings time for 2010 and the UTC offset of New York.</li>
<li>Specify the <em>Leaf cycle</em> = winter when initialising in January.
Unless the user has better information initialise the <em>Soil moisture
state</em> at 100 %.</li>
<li>Select an output folder where the initial data to run SUEWS should be
saved and press <em>Generate</em>.</li>
<li>Open SUEWS at <em>UMEP &gt; Processer &gt; Urban Energy Balance &gt; Urban Energy
Balance (SUEWS/BLUEWS, advanced).</em> Using this for the first time, the system will ask you to download the latest version of SUEWS, click <em>OK</em>.</li>
<li>Change the OHM option to [1]. This allows the anthropogenic energy to be partitioned also into the storage energy term.</li>
<li>Leave the rest of the combobox settings at the top as default and tick both the <em>Use snow module</em> and the <em>Obtain temporal resolution…</em> box.</li>
<li>Set the <em>Temporal resolution of output (minutes)</em> to 60.</li>
<li>Locate the directory where you saved your output from SUEWSPrepare earlier and choose an output folder of your choice.</li>
<li>Also, Tick the box <em>Apply spin-up using…</em>. This will force the model to run twice using the conditions from the first run as initial conditions for the second run.</li>
<li>Click Run. This computation will take a while so be patient. If it only takes a very short time (a few seconds) the model has probably crashed. Please consult the <em>problems.txt</em> file for more information.</li>
</ol>
</div>
<div class="section" id="analysing-model-reults">
<h2>9.4.8. Analysing model reults<a class="headerlink" href="#analysing-model-reults" title="Permalink to this headline">¶</a></h2>
<p>When the model has successfully run, it is time to look at some of the output of the model. The SUEWSAnalyser tool is available from the post-processing section in UMEP.</p>
<ol class="arabic simple">
<li>To better visualise what would be interesting to plot, label the grid ID’s of your vector grid. Do this by right-clicking the vector grid, going to <em>properties</em>, under the <em>Labels</em> tab click <em>Show labels for this layer</em>, label with <strong>id</strong> and select a text format of your choosing.</li>
<li>Open <em>UMEP &gt; Post-Processor &gt; Urban Energy Balance &gt; SUEWS Analyzer</em>. There are two main sections in this tool. The Plot data-section can be used to make temporal analysis as well as making simple comparisins between two grids or variables. This Spatial data-section can be used to make aggregated maps of the output variables from the SUEWS model. This requires that you have loaded the same polygon grid into your QGIS project that was used when you prepared the input data for SUEWS using SUEWS Prepare earlier in this tutorial.</li>
<li>To access the output data from the a model run, the <strong>RunControl.nml</strong> file for that particular run must be located. If your run has been made through UMEP, this file can be found in your output folder. Otherwise, this file can be located in the same folder from where the model was executed. In the top panel of <em>SUEWS Analyzer</em>, load the <strong>RunControl.nml</strong> located in the output folder.</li>
</ol>
<p>Feel free to try plotting different variables, first let’s try and look at a variable for two different grid cells.</p>
<ol class="arabic simple">
<li>Load the <strong>RunControl.nml</strong> located in the output folder.</li>
<li>On the left hand specify a <em>Grid</em> cell that is largely urban, select <em>Year</em> to investigate. Select the desired time period and a variable, for example <em>Sensible heat flux</em>.</li>
<li>Comparing with another less urbanised gridcell turn on <em>include another variable</em> and specify the desired <em>Grid</em>, selecting the same <em>Variable</em> (Sensible heat flux).</li>
<li>Click <em>plot</em>.</li>
</ol>
<div class="figure" id="id4">
<img alt="none" src="../../../../../_images/suews_qh.png" />
<p class="caption"><span class="caption-number">Fig. 9.26 </span><span class="caption-text">Example of the comparison of the heat flux for two grid cell in the vector grid.</span></p>
</div>
<p>Now we will look at the horizontal distribution of the storage flux.
#. On the right-hand side of <em>SUEWS analyser</em> specify the <strong>Net Storage flux</strong> as a <em>variable to analyse</em>.
#. Select the <em>Year to investigate</em> and a time period during the summer season.
#. Select the <em>Median</em> and <em>Only daytime</em>.
#. Select the <em>Vector polygon grid</em> you have been using and <em>save as a GeoTiff</em>.
#. Specify an <em>output filename</em>, and tick <em>Add Geotiff to map canvas</em> and <em>Generate</em>.</p>
<div class="figure" id="id5">
<img alt="none" src="../../../../../_images/SUEWS_DQS.png" />
<p class="caption"><span class="caption-number">Fig. 9.27 </span><span class="caption-text">Example of the median, night-time net storage flux.</span></p>
</div>
<p>This should generate a geotiff file with a median, night-time net storage flux in the selected timeperiod.</p>
<p>Tutorial finished.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../../../development/development.html" class="btn btn-neutral float-right" title="10. Development, Suggestions and Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="SuewsSpatial.html" class="btn btn-neutral" title="9.3. Urban Energy Balance - SUEWS Spatial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018 – 2019, micromet@University of Reading, led by Prof Sue Grimmond

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>